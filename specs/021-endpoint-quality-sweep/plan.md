# Implementation Plan: Endpoint Quality Sweep

**Branch**: `021-endpoint-quality-sweep` | **Date**: 2026-02-28 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `/specs/021-endpoint-quality-sweep/spec.md`

## Summary

Establish a repeatable per-endpoint quality workflow and demonstrate it on `GET /contacts/{contactId}/editdetails` (ContactDetailedInfo). The model has 31 undeclared fields causing G1=FAIL and `test_get_details` failure. The C# source (`ContactEditDetails` → `ContactExtendedDetails<T>` → `ContactBaseDetails`) provides ground-truth field definitions. We add typed nested models matching the C# DTOs, reuse the existing `CompanyAddress` model, and update tests/docs to pass all 6 gates.

## Technical Context

**Language/Version**: Python 3.11+ + pydantic>=2.0, requests (existing SDK)
**Primary Dependencies**: pydantic>=2.0, requests (no new deps)
**Storage**: Filesystem (fixture JSON files in `tests/fixtures/`)
**Testing**: pytest (non-live: `pytest -m "not live"`)
**Target Platform**: Python SDK (pip-installable library)
**Project Type**: single
**Constraints**: No fabricated fixtures; models must match live API responses

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Status | Notes |
|-----------|--------|-------|
| I. Pydantic Model Fidelity | PASS (after fix) | Adding all C#-sourced fields with correct types, aliases, descriptions |
| II. Example-Driven Fixture Capture | PASS | Fixture already captured live (`tests/fixtures/ContactDetailedInfo.json`) |
| III. Four-Way Harmony | PASS (after fix) | Implementation + example + fixture/test + docs all updated |
| IV. Swagger-Informed, Reality-Validated | PASS | Using C# source (Tier 1) + fixture (Tier 2) as ground truth |
| V. Endpoint Status Tracking | PASS | FIXTURES.md regenerated by route-driven sync |
| VI. Documentation Completeness | PASS (after fix) | docs/api/contacts.md updated with field details |
| VII. Flywheel Evolution | N/A | No stakeholder-visible change |
| VIII. Phase-Based Context Recovery | PASS | Single commit with all artifacts |
| IX. Endpoint Input Validation | N/A | GET endpoint — no request body |

## Project Structure

### Documentation (this feature)

```text
specs/021-endpoint-quality-sweep/
├── plan.md              # This file
├── research.md          # C# source analysis
├── data-model.md        # Model field mapping
├── quickstart.md        # Per-endpoint checklist
└── checklists/
    └── requirements.md  # Spec quality checklist
```

### Source Code (repository root)

```text
ab/api/models/
├── contacts.py          # EDIT — add fields to ContactDetailedInfo
└── common.py            # REFERENCE — reuse CompanyAddress, Coordinates

tests/
├── models/
│   └── test_contact_models.py   # EDIT — uncomment assert_no_extra_fields
├── integration/
│   └── test_contacts.py         # REFERENCE — already has assert_no_extra_fields
└── fixtures/
    └── ContactDetailedInfo.json # REFERENCE — ground truth fixture

docs/api/
└── contacts.md          # EDIT — update get_details section
```

**Structure Decision**: Existing single-project layout. No new files needed beyond spec artifacts — all changes are edits to existing files.

## Constitution Re-Check (Post-Design)

| Principle | Status | Notes |
|-----------|--------|-------|
| I. Pydantic Model Fidelity | PASS | All 31 fields mapped from C# source with types, aliases, descriptions. Typed sub-models for nested lists. |
| II. Example-Driven Fixture Capture | PASS | Fixture exists, captured live on 2026-02-13 from staging |
| III. Four-Way Harmony | PASS | Model + example + test + docs all accounted for in plan |
| IV. Swagger-Informed, Reality-Validated | PASS | C# source (Tier 1) used; fixture (Tier 2) cross-referenced; swagger deviation documented |
| V. Endpoint Status Tracking | PASS | Route-driven sync already in place |
| VI. Documentation Completeness | PASS | docs/api/contacts.md entry exists, will update field references |
| VII. Flywheel Evolution | N/A | |
| VIII. Phase-Based Context Recovery | PASS | All changes in single commit; checklist is machine-readable |
| IX. Endpoint Input Validation | N/A | GET endpoint, no request body |

No violations. No complexity tracking needed.
